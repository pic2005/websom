{% extends "base.html" %}

{% block title %}‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏≠‡∏≤‡∏Å‡∏≤‡∏£‡∏õ‡∏ß‡∏î - Women's Stories{% endblock %}

{% block body %}
<div class="container mt-5">
    <!-- ‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏£‡∏≠‡∏ö‡πÄ‡∏î‡∏∑‡∏≠‡∏ô‡∏ñ‡∏±‡∏î‡πÑ‡∏õ -->
    <h1 class="text-center mb-4 text-white">‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏£‡∏≠‡∏ö‡πÄ‡∏î‡∏∑‡∏≠‡∏ô‡∏ñ‡∏±‡∏î‡πÑ‡∏õ</h1>
    <div class="card p-4 shadow mb-5">
        <label for="lastPeriod" class="form-label">‡∏Å‡∏£‡∏≠‡∏Å‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏õ‡∏£‡∏∞‡∏à‡∏≥‡πÄ‡∏î‡∏∑‡∏≠‡∏ô‡∏°‡∏≤‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î:</label>
        <input type="date" id="lastPeriod" class="form-control" />
        <button class="btn btn-primary mt-3" onclick="calculateNextPeriod()">‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì</button>
        <p class="mt-3" id="nextPeriodResult"></p>
    </div>
    
    <h1 class="text-center mb-4 text-white">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏≠‡∏≤‡∏Å‡∏≤‡∏£‡∏õ‡∏ß‡∏î</h1>

    <!-- ‡∏ü‡∏≠‡∏£‡πå‡∏°‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏≠‡∏≤‡∏Å‡∏≤‡∏£‡∏õ‡∏ß‡∏î -->
    <form method="POST" action="{{ url_for('save_period_and_pain_log') }}" class="card p-4 mb-5 shadow">
        <div class="mb-3">
            <label for="period_start_date" class="form-label">‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏°‡∏µ‡∏õ‡∏£‡∏∞‡∏à‡∏≥‡πÄ‡∏î‡∏∑‡∏≠‡∏ô:</label>
            <input type="date" id="period_start_date" name="period_start_date" class="form-control" required>
        </div>
        <div class="mb-3">
            <label for="period_end_date" class="form-label">‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏´‡∏°‡∏î‡∏õ‡∏£‡∏∞‡∏à‡∏≥‡πÄ‡∏î‡∏∑‡∏≠‡∏ô:</label>
            <input type="date" id="period_end_date" name="period_end_date" class="form-control" required>
        </div>
        <div class="mb-3">
            <label for="pain_level" class="form-label">‡∏£‡∏∞‡∏î‡∏±‡∏ö‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏à‡πá‡∏ö‡∏õ‡∏ß‡∏î:</label>
            <select id="pain_level" name="pain_level" class="form-select" required>
                <option value="1">üòä ‡πÑ‡∏°‡πà‡πÄ‡∏à‡πá‡∏ö</option>
                <option value="2">üòê ‡πÄ‡∏à‡πá‡∏ö‡πÄ‡∏•‡πá‡∏Å‡∏ô‡πâ‡∏≠‡∏¢</option>
                <option value="3">üòï ‡πÄ‡∏à‡πá‡∏ö‡∏õ‡∏≤‡∏ô‡∏Å‡∏•‡∏≤‡∏á</option>
                <option value="4">üò£ ‡πÄ‡∏à‡πá‡∏ö‡∏°‡∏≤‡∏Å</option>
                <option value="5">üò´ ‡πÄ‡∏à‡πá‡∏ö‡∏°‡∏≤‡∏Å‡∏ó‡∏µ‡πà‡∏™‡∏∏‡∏î</option>
            </select>
        </div>
        <div class="mb-3">
            <label for="pain_note" class="form-label">‡∏≠‡∏≤‡∏Å‡∏≤‡∏£‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏ï‡∏¥‡∏°:</label>
            <textarea id="pain_note" name="pain_note" rows="4" class="form-control"></textarea>
        </div>
        <button type="submit" class="btn btn-primary w-100">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</button>
    </form>

    <h1 class="text-center mb-4 text-white">‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏Å‡∏≤‡∏£‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏≠‡∏≤‡∏Å‡∏≤‡∏£‡∏õ‡∏ß‡∏î</h1>
    <div class="table-responsive">
        <table class="table table-bordered table-hover shadow">
            <thead class="table-primary">
                <tr>
                    <th>‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà</th>
                    <th>‡∏£‡∏∞‡∏î‡∏±‡∏ö‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏à‡πá‡∏ö‡∏õ‡∏ß‡∏î</th>
                    <th>‡∏≠‡∏≤‡∏Å‡∏≤‡∏£‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏ï‡∏¥‡∏°</th>
                </tr>
            </thead>
            <tbody>
                {% for log in pain_logs %}
                <tr>
                    <td>{{ log.log_date.strftime('%d-%m-%Y %H:%M') }}</td>
                    <td>{{ log.pain_level }}</td>
                    <td>{{ log.pain_note }}</td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
</div>

<script>
    function calculateNextPeriod() {
        let lastPeriodDate = document.getElementById('lastPeriod').value;
        if (!lastPeriodDate) {
            document.getElementById('nextPeriodResult').innerText = "‡πÇ‡∏õ‡∏£‡∏î‡∏Å‡∏£‡∏≠‡∏Å‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏õ‡∏£‡∏∞‡∏à‡∏≥‡πÄ‡∏î‡∏∑‡∏≠‡∏ô‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î";
            return;
        }
        let lastDate = new Date(lastPeriodDate);
        let nextDate = new Date(lastDate);
        nextDate.setDate(lastDate.getDate() + 28); // ‡∏™‡∏°‡∏°‡∏ï‡∏¥‡∏ß‡πà‡∏≤‡∏£‡∏≠‡∏ö‡πÄ‡∏î‡∏∑‡∏≠‡∏ô‡πÄ‡∏â‡∏•‡∏µ‡πà‡∏¢ 28 ‡∏ß‡∏±‡∏ô
        let options = { year: 'numeric', month: 'long', day: 'numeric' };
        document.getElementById('nextPeriodResult').innerText = "‡∏õ‡∏£‡∏∞‡∏à‡∏≥‡πÄ‡∏î‡∏∑‡∏≠‡∏ô‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡∏ñ‡∏±‡∏î‡πÑ‡∏õ‡∏Ñ‡∏≤‡∏î‡∏ß‡πà‡∏≤‡∏à‡∏∞‡∏°‡∏≤‡πÉ‡∏ô‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà " + nextDate.toLocaleDateString('th-TH', options);
    }
</script>
{% endblock %}
